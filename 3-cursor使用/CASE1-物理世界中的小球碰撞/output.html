<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ç†ä¸–ç•Œä¸­çš„å°çƒç¢°æ’</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .canvas-container {
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
        }

        #gameCanvas {
            display: block;
            background: rgba(0, 0, 0, 0.1);
        }

        .info {
            margin-top: 15px;
            color: white;
            text-align: center;
            font-size: 14px;
            opacity: 0.8;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ€ ç‰©ç†ä¸–ç•Œä¸­çš„å°çƒç¢°æ’</h1>
        
        <div class="controls">
            <button onclick="startAnimation()">å¼€å§‹è¿åŠ¨</button>
            <button onclick="pauseAnimation()">æš‚åœ</button>
            <button onclick="resetAnimation()">é‡ç½®</button>
            <button onclick="changeSpeed()">æ”¹å˜é€Ÿåº¦</button>
        </div>

        <div class="canvas-container">
            <canvas id="gameCanvas" width="600" height="400"></canvas>
        </div>

        <div class="info">
            <p>çº¢è‰²å°çƒåœ¨ä¸‰è§’å½¢åŒºåŸŸå†…è¿åŠ¨ï¼Œç¢°åˆ°è¾¹ç•Œä¼šè‡ªåŠ¨åå¼¹</p>
            <div class="stats">
                <div class="stat">ç¢°æ’æ¬¡æ•°: <span id="collisionCount">0</span></div>
                <div class="stat">è¿åŠ¨æ—¶é—´: <span id="elapsedTime">0</span>ç§’</div>
                <div class="stat">å½“å‰é€Ÿåº¦: <span id="currentSpeed">5</span>px/s</div>
            </div>
        </div>
    </div>

    <script>
        // è·å–ç”»å¸ƒå’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // å°çƒå±æ€§
        const ball = {
            x: 300,
            y: 200,
            radius: 15,
            dx: 3,
            dy: 2,
            speed: 5,
            color: '#ff4757'
        };

        // ä¸‰è§’å½¢è¾¹ç•Œç‚¹
        const triangle = [
            { x: 50, y: 350 },   // å·¦ä¸‹è§’
            { x: 550, y: 350 },  // å³ä¸‹è§’
            { x: 300, y: 50 }    // é¡¶éƒ¨
        ];

        // åŠ¨ç”»çŠ¶æ€
        let animationId = null;
        let isRunning = false;
        let startTime = Date.now();
        let collisionCount = 0;

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('collisionCount').textContent = collisionCount;
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('elapsedTime').textContent = elapsed;
            document.getElementById('currentSpeed').textContent = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy).toFixed(1);
        }

        // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…
        function isPointInTriangle(px, py) {
            const [p1, p2, p3] = triangle;
            
            // ä½¿ç”¨é‡å¿ƒåæ ‡æ³•åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…
            const denominator = ((p2.y - p3.y) * (p1.x - p3.x) + (p3.x - p2.x) * (p1.y - p3.y));
            const a = ((p2.y - p3.y) * (px - p3.x) + (p3.x - p2.x) * (py - p3.y)) / denominator;
            const b = ((p3.y - p1.y) * (px - p3.x) + (p1.x - p3.x) * (py - p3.y)) / denominator;
            const c = 1 - a - b;
            
            return a >= 0 && b >= 0 && c >= 0;
        }

        // è®¡ç®—ç‚¹åˆ°çº¿æ®µçš„è·ç¦»
        function distanceToLineSegment(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;
            
            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            
            if (lenSq === 0) return Math.sqrt(A * A + B * B);
            
            let param = dot / lenSq;
            param = Math.max(0, Math.min(1, param));
            
            const xx = x1 + param * C;
            const yy = y1 + param * D;
            
            const dx = px - xx;
            const dy = py - yy;
            
            return Math.sqrt(dx * dx + dy * dy);
        }

        // æ£€æŸ¥ä¸ä¸‰è§’å½¢è¾¹ç•Œçš„ç¢°æ’
        function checkTriangleCollision() {
            const [p1, p2, p3] = triangle;
            const ballCenter = { x: ball.x, y: ball.y };
            
            // æ£€æŸ¥ä¸ä¸‰æ¡è¾¹çš„ç¢°æ’
            const edges = [
                [p1, p2], // åº•è¾¹
                [p2, p3], // å³è¾¹
                [p3, p1]  // å·¦è¾¹
            ];
            
            for (let edge of edges) {
                const [start, end] = edge;
                const distance = distanceToLineSegment(ball.x, ball.y, start.x, start.y, end.x, end.y);
                
                if (distance <= ball.radius) {
                    // è®¡ç®—åå¼¹æ–¹å‘
                    const edgeVector = {
                        x: end.x - start.x,
                        y: end.y - start.y
                    };
                    
                    // è®¡ç®—æ³•å‘é‡ï¼ˆå‚ç›´äºè¾¹ï¼‰
                    const normal = {
                        x: -edgeVector.y,
                        y: edgeVector.x
                    };
                    
                    // å½’ä¸€åŒ–æ³•å‘é‡
                    const length = Math.sqrt(normal.x * normal.x + normal.y * normal.y);
                    normal.x /= length;
                    normal.y /= length;
                    
                    // è®¡ç®—é€Ÿåº¦åœ¨æ³•å‘é‡ä¸Šçš„æŠ•å½±
                    const dotProduct = ball.dx * normal.x + ball.dy * normal.y;
                    
                    // åå¼¹ï¼šé€Ÿåº¦å‡å»æ³•å‘é‡æŠ•å½±çš„ä¸¤å€
                    ball.dx -= 2 * dotProduct * normal.x;
                    ball.dy -= 2 * dotProduct * normal.y;
                    
                    collisionCount++;
                    return true;
                }
            }
            
            return false;
        }

        // æ›´æ–°å°çƒä½ç½®
        function updateBall() {
            // æ›´æ–°ä½ç½®
            ball.x += ball.dx;
            ball.y += ball.dy;
            
            // æ£€æŸ¥ç¢°æ’
            checkTriangleCollision();
            
            // ç¡®ä¿å°çƒä¸ä¼šå®Œå…¨ç¦»å¼€ä¸‰è§’å½¢åŒºåŸŸ
            if (!isPointInTriangle(ball.x, ball.y)) {
                // å¦‚æœå°çƒç¦»å¼€ä¸‰è§’å½¢ï¼Œå°†å…¶æ‹‰å›ä¸­å¿ƒ
                ball.x = 300;
                ball.y = 200;
            }
        }

        // ç»˜åˆ¶ä¸‰è§’å½¢
        function drawTriangle() {
            ctx.beginPath();
            ctx.moveTo(triangle[0].x, triangle[0].y);
            ctx.lineTo(triangle[1].x, triangle[1].y);
            ctx.lineTo(triangle[2].x, triangle[2].y);
            ctx.closePath();
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ç»˜åˆ¶åŠé€æ˜å¡«å……
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fill();
        }

        // ç»˜åˆ¶å°çƒ
        function drawBall() {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = ball.color;
            ctx.fill();
            
            // æ·»åŠ é«˜å…‰æ•ˆæœ
            ctx.beginPath();
            ctx.arc(ball.x - 5, ball.y - 5, 5, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.fill();
        }

        // ç»˜åˆ¶é€Ÿåº¦å‘é‡
        function drawVelocityVector() {
            const scale = 3;
            ctx.beginPath();
            ctx.moveTo(ball.x, ball.y);
            ctx.lineTo(ball.x + ball.dx * scale, ball.y + ball.dy * scale);
            ctx.strokeStyle = 'rgba(255, 255, 0, 0.8)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´
            const angle = Math.atan2(ball.dy, ball.dx);
            const arrowLength = 10;
            const arrowX = ball.x + ball.dx * scale;
            const arrowY = ball.y + ball.dy * scale;
            
            ctx.beginPath();
            ctx.moveTo(arrowX, arrowY);
            ctx.lineTo(arrowX - arrowLength * Math.cos(angle - Math.PI/6), 
                      arrowY - arrowLength * Math.sin(angle - Math.PI/6));
            ctx.moveTo(arrowX, arrowY);
            ctx.lineTo(arrowX - arrowLength * Math.cos(angle + Math.PI/6), 
                      arrowY - arrowLength * Math.sin(angle + Math.PI/6));
            ctx.stroke();
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            if (!isRunning) return;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ä¸‰è§’å½¢
            drawTriangle();
            
            // æ›´æ–°å°çƒä½ç½®
            updateBall();
            
            // ç»˜åˆ¶å°çƒ
            drawBall();
            
            // ç»˜åˆ¶é€Ÿåº¦å‘é‡
            drawVelocityVector();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            // ç»§ç»­åŠ¨ç”»
            animationId = requestAnimationFrame(animate);
        }

        // å¼€å§‹åŠ¨ç”»
        function startAnimation() {
            if (!isRunning) {
                isRunning = true;
                startTime = Date.now();
                animate();
            }
        }

        // æš‚åœåŠ¨ç”»
        function pauseAnimation() {
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        }

        // é‡ç½®åŠ¨ç”»
        function resetAnimation() {
            pauseAnimation();
            ball.x = 300;
            ball.y = 200;
            ball.dx = 3;
            ball.dy = 2;
            collisionCount = 0;
            startTime = Date.now();
            updateStats();
            
            // é‡ç»˜é™æ€ç”»é¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawTriangle();
            drawBall();
            drawVelocityVector();
        }

        // æ”¹å˜é€Ÿåº¦
        function changeSpeed() {
            const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
            const newSpeed = speed * 1.5;
            const ratio = newSpeed / speed;
            
            ball.dx *= ratio;
            ball.dy *= ratio;
        }

        // åˆå§‹åŒ–
        function init() {
            resetAnimation();
            
            // æ·»åŠ é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        if (isRunning) {
                            pauseAnimation();
                        } else {
                            startAnimation();
                        }
                        break;
                    case 'r':
                    case 'R':
                        resetAnimation();
                        break;
                    case 's':
                    case 'S':
                        changeSpeed();
                        break;
                }
            });
        }

        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>
