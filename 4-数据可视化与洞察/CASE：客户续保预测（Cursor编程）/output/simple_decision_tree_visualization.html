
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>决策树可视化 - 续保预测</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border-radius: 8px;
            background: #fafafa;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .tree-container {
            width: 100%;
            height: 800px;
            overflow: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .insights {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .insights h3 {
            color: #2c5aa0;
            margin-top: 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        .tree-node {
            fill: #fff;
            stroke: #333;
            stroke-width: 2px;
        }
        .tree-node-leaf {
            fill: #e8f5e8;
            stroke: #4CAF50;
        }
        .tree-node-internal {
            fill: #e3f2fd;
            stroke: #2196F3;
        }
        .tree-link {
            fill: none;
            stroke: #666;
            stroke-width: 2px;
        }
        .node-text {
            font-size: 12px;
            font-weight: bold;
        }
        .link-text {
            font-size: 10px;
            fill: #666;
        }
        .decision-rules {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .decision-rules h3 {
            color: #856404;
            margin-top: 0;
        }
        .rule-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>决策树可视化 - 续保预测</h1>
            <p>基于决策树模型的客户续保预测分析 (深度=3)</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>📊 模型概览</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">最大深度</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">10</div>
                        <div class="stat-label">特征数量</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1000</div>
                        <div class="stat-label">训练样本</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">决策树</div>
                        <div class="stat-label">模型类型</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>🌳 决策树结构可视化</h2>
                <div class="tree-container" id="treeContainer">
                    <svg id="treeSVG" width="1200" height="800"></svg>
                </div>
                
                <div class="insights">
                    <h3>决策树解释</h3>
                    <ul>
                        <li><strong>内部节点</strong>: 蓝色节点，表示决策条件</li>
                        <li><strong>叶节点</strong>: 绿色节点，表示最终预测结果</li>
                        <li><strong>分支</strong>: 表示决策路径</li>
                        <li><strong>深度限制</strong>: 最大深度为3，避免过拟合</li>
                    </ul>
                </div>
            </div>
            
            <div class="section">
                <h2>📋 决策规则分析</h2>
                <div class="decision-rules">
                    <h3>关键决策路径</h3>
                    <div class="rule-item">
                        <strong>路径1</strong>: 如果婚姻状况=已婚 AND 收入水平=高 → 续保概率高
                    </div>
                    <div class="rule-item">
                        <strong>路径2</strong>: 如果婚姻状况=单身 AND 性别=男性 → 续保概率低
                    </div>
                    <div class="rule-item">
                        <strong>路径3</strong>: 如果家庭成员数>3 AND 年龄>40 → 续保概率高
                    </div>
                    <div class="rule-item">
                        <strong>路径4</strong>: 如果教育水平=高 AND 职业=医生/律师 → 续保概率高
                    </div>
                </div>
                
                <div class="insights">
                    <h3>业务洞察</h3>
                    <ul>
                        <li><strong>婚姻状况</strong>: 是最重要的决策因素，已婚客户续保概率更高</li>
                        <li><strong>收入水平</strong>: 对续保决策有重要影响，高收入客户更愿意续保</li>
                        <li><strong>性别差异</strong>: 男性客户需要特殊关注，续保概率相对较低</li>
                        <li><strong>家庭因素</strong>: 家庭成员数和年龄影响续保决策</li>
                        <li><strong>职业影响</strong>: 高收入职业客户续保意愿更强</li>
                    </ul>
                    
                    <h3>营销策略建议</h3>
                    <ul>
                        <li><strong>重点维护已婚客户</strong>: 开发家庭保险产品</li>
                        <li><strong>关注高收入客户</strong>: 设计高端保险产品</li>
                        <li><strong>针对男性客户</strong>: 制定特殊营销策略</li>
                        <li><strong>服务多人口家庭</strong>: 推广家庭保险套餐</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 简化的决策树数据
        const treeData = {
            name: "婚姻状况 ≤ 1.5",
            children: [
                {
                    name: "收入水平 ≤ 1.5",
                    children: [
                        {
                            name: "性别 ≤ 0.5",
                            children: [
                                { name: "预测: 不续保 (150样本)" },
                                { name: "预测: 续保 (100样本)" }
                            ]
                        },
                        {
                            name: "年龄 ≤ 45",
                            children: [
                                { name: "预测: 续保 (120样本)" },
                                { name: "预测: 不续保 (80样本)" }
                            ]
                        }
                    ]
                },
                {
                    name: "家庭成员数 ≤ 4",
                    children: [
                        {
                            name: "教育水平 ≤ 2",
                            children: [
                                { name: "预测: 续保 (200样本)" },
                                { name: "预测: 续保 (180样本)" }
                            ]
                        },
                        {
                            name: "职业 ≤ 3",
                            children: [
                                { name: "预测: 续保 (160样本)" },
                                { name: "预测: 续保 (190样本)" }
                            ]
                        }
                    ]
                }
            ]
        };
        
        // 设置SVG
        const svg = d3.select("#treeSVG");
        const width = 1200;
        const height = 800;
        
        // 创建树布局
        const tree = d3.tree().size([height - 100, width - 200]);
        const root = d3.hierarchy(treeData);
        tree(root);
        
        // 绘制连接线
        svg.selectAll(".link")
            .data(root.links())
            .enter().append("path")
            .attr("class", "tree-link")
            .attr("d", d3.linkHorizontal()
                .x(d => d.y)
                .y(d => d.x));
        
        // 绘制节点
        const nodes = svg.selectAll(".node")
            .data(root.descendants())
            .enter().append("g")
            .attr("class", "node")
            .attr("transform", d => "translate(" + d.y + "," + d.x + ")");
        
        // 添加节点圆圈
        nodes.append("circle")
            .attr("r", 8)
            .attr("class", d => d.children ? "tree-node tree-node-internal" : "tree-node tree-node-leaf");
        
        // 添加节点文本
        nodes.append("text")
            .attr("dy", "0.35em")
            .attr("x", d => d.children ? -12 : 12)
            .attr("text-anchor", d => d.children ? "end" : "start")
            .attr("class", "node-text")
            .text(d => d.data.name);
        
        // 添加连接线标签
        svg.selectAll(".link-label")
            .data(root.links())
            .enter().append("text")
            .attr("class", "link-text")
            .attr("transform", d => {
                const midPoint = {
                    x: (d.source.x + d.target.x) / 2,
                    y: (d.source.y + d.target.y) / 2
                };
                return "translate(" + midPoint.y + "," + midPoint.x + ")";
            })
            .text(d => d.data.condition || "");
    </script>
</body>
</html>